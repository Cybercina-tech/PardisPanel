{% extends "base.html" %}
{% load static %}

{% block title %}Template Editor Â· {{ template.name }}{% endblock %}

{% block extra_head %}
<style>
    .editor-container {
        display: flex;
        gap: 20px;
        min-height: 600px;
    }
    
    .editor-left {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .editor-right {
        width: 400px;
        display: flex;
        flex-direction: column;
    }
    
    .field-list {
        background: var(--bs-dark);
        border-radius: 8px;
        padding: 20px;
        max-height: 400px;
        overflow-y: auto;
    }
    
    .field-item {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .field-item h6 {
        color: var(--bs-gold);
        margin-bottom: 10px;
    }
    
    .field-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    
    .preview-panel {
        background: var(--bs-dark);
        border-radius: 8px;
        padding: 20px;
        position: sticky;
        top: 20px;
    }
    
    .preview-image {
        width: 100%;
        border-radius: 8px;
        border: 2px solid rgba(255, 255, 255, 0.1);
        background: #000;
    }
    
    .add-field-form {
        background: var(--bs-dark);
        border-radius: 8px;
        padding: 20px;
    }
    
    .form-group {
        margin-bottom: 15px;
    }
    
    .form-group label {
        color: var(--bs-gold);
        font-weight: 600;
        margin-bottom: 5px;
        display: block;
    }
    
    .btn-remove-field {
        margin-top: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="py-4">
    <div class="mb-4 d-flex justify-content-between align-items-center">
        <div>
            <h1 class="text-gold fw-bold mb-2">
                <i class="fas fa-edit me-2"></i>
                Template Editor: {{ template.name }}
            </h1>
            <p class="text-white-50 mb-0">Configure text fields and their positions</p>
        </div>
        <div>
            <a href="{% url 'template_editor_frontend:list' %}" class="btn btn-outline-secondary me-2">
                <i class="fas fa-arrow-left me-2"></i>
                Back to List
            </a>
            <button type="button" id="saveBtn" class="btn btn-gold">
                <i class="fas fa-save me-2"></i>
                Save Template
            </button>
        </div>
    </div>

    <div class="editor-container">
        <!-- Left Panel: Field Configuration -->
        <div class="editor-left">
            <!-- Add New Field Form -->
            <div class="add-field-form">
                <h4 class="text-gold mb-3">
                    <i class="fas fa-plus-circle me-2"></i>
                    Add Text Field
                </h4>
                <form id="addFieldForm">
                    <div class="form-group">
                        <label for="fieldName">Field Name *</label>
                        <input type="text" id="fieldName" class="form-control" placeholder="e.g., english_date" required>
                        <small class="text-muted">This will be the key used in dynamic_data_dict</small>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="fieldX">X Coordinate *</label>
                                <input type="number" id="fieldX" class="form-control" min="0" step="1" value="0" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="fieldY">Y Coordinate *</label>
                                <input type="number" id="fieldY" class="form-control" min="0" step="1" value="0" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="fieldSize">Font Size *</label>
                                <input type="number" id="fieldSize" class="form-control" min="8" max="200" value="32" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="fieldColor">Color *</label>
                                <input type="color" id="fieldColor" class="form-control" value="#000000" style="height: 40px;">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="fieldAlign">Alignment</label>
                                <select id="fieldAlign" class="form-select">
                                    <option value="left">Left</option>
                                    <option value="center">Center</option>
                                    <option value="right">Right</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="fieldMaxWidth">Max Width (optional)</label>
                                <input type="number" id="fieldMaxWidth" class="form-control" min="0" step="1" placeholder="Auto">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="fieldWeight">Font Weight</label>
                        <input type="text" id="fieldWeight" class="form-control" value="normal" placeholder="normal, bold, etc.">
                    </div>
                    
                    <button type="submit" class="btn btn-gold w-100">
                        <i class="fas fa-plus me-2"></i>
                        Add Field
                    </button>
                </form>
            </div>

            <!-- Existing Fields List -->
            <div class="field-list">
                <h4 class="text-gold mb-3">
                    <i class="fas fa-list me-2"></i>
                    Configured Fields
                </h4>
                <div id="fieldsList">
                    <p class="text-white-50 text-center">No fields added yet. Add a field above to get started.</p>
                </div>
            </div>
        </div>

        <!-- Right Panel: Live Preview -->
        <div class="editor-right">
            <div class="preview-panel">
                <h4 class="text-gold mb-3">
                    <i class="fas fa-eye me-2"></i>
                    Live Preview
                </h4>
                <div class="mb-3">
                    <img id="previewImage" class="preview-image" src="{% url 'template_editor_frontend:preview' template.pk %}" alt="Preview">
                </div>
                <button type="button" id="refreshPreview" class="btn btn-outline-gold w-100">
                    <i class="fas fa-sync me-2"></i>
                    Refresh Preview
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Hidden input to store config -->
<input type="hidden" id="templateConfig" value='{{ config|safe }}'>
<input type="hidden" id="templateId" value="{{ template.pk }}">
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'template_editor/template_editor.js' %}"></script>
{% endblock %}
